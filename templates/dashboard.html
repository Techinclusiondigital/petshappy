<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

</head>
<body>

<header>
    <h1 class="bienvenido">ğŸ¾ Bienvenid@, {{ current_user.nombre_usuario }}</h1>
  
</header>
{% if not current_user.subscripcion_id and not current_user.en_periodo_prueba() %}
<div style="background-color: #ffe5e5; padding: 20px; margin: 20px auto; border: 1px solid red; max-width: 500px; text-align: center;">
    <h2 style="color: red;">ğŸš« Tu prueba gratuita ha caducado</h2>
    <p>Activa tu suscripciÃ³n para seguir usando la aplicaciÃ³n</p>

    <!-- BotÃ³n de PayPal -->
    <div id="paypal-button-container"></div>
    <script src="https://www.paypal.com/sdk/js?client-id=AdKDB9XxfhHs8k-nO1sNPQVn2S2-kEih3HgO9Byj147xHOB4FLaIUVc0EGId3a6oECFgrdGP54KsQAUK&vault=true&intent=subscription"></script>
    <script>
        paypal.Buttons({
            style: {
                shape: 'rect',
                color: 'gold',
                layout: 'vertical',
                label: 'subscribe'
            },
            createSubscription: function(data, actions) {
                return actions.subscription.create({
                    plan_id: 'P-0YP52904YG949224RNAY3BJY'
                });
            },
            onApprove: function(data, actions) {
                alert("âœ… SuscripciÃ³n realizada. ID: " + data.subscriptionID);
                window.location.href = "/suscripcion_exitosa?sub_id=" + data.subscriptionID;
            }
        }).render('#paypal-button-container');
    </script>
</div>
{% elif current_user.en_periodo_prueba() and not current_user.subscripcion_id %}
<div style="background-color: #e0f7fa; padding: 20px; margin: 20px auto; border: 1px solid #00bcd4; max-width: 500px; text-align: center;">
    <h3>â³ Tu prueba gratuita finaliza en:</h3>
    <div id="contador" style="font-size: 20px; font-weight: bold;"></div>
</div>
<script>
   const finPrueba = new Date("{{ fecha_fin_prueba }}T00:00:00Z");
 

    function actualizarContador() {
        const ahora = new Date();
        const tiempoRestante = finPrueba - ahora;

        if (tiempoRestante <= 0) {
            document.getElementById("contador").textContent = "ğŸš« Prueba finalizada";
            return;
        }

        const dias = Math.floor(tiempoRestante / (1000 * 60 * 60 * 24));
        const horas = Math.floor((tiempoRestante / (1000 * 60 * 60)) % 24);
        const minutos = Math.floor((tiempoRestante / (1000 * 60)) % 60);
        const segundos = Math.floor((tiempoRestante / 1000) % 60);

        document.getElementById("contador").textContent = `${dias} dÃ­as, ${horas}h ${minutos}m ${segundos}s`;
    }

    setInterval(actualizarContador, 1000);
    actualizarContador();
</script>
{% endif %}

<button class="menu-toggle" onclick="toggleMenu()">â˜° MenÃº</button>

<nav>
    <ul class="nav-links" id="navMenu">
        <li><a href="/registrar">Registrar mascota</a></li>
        <li><a href="/mascotas">Ver mascotas</a></li>
        <li><a href="/buscar-mascota">Buscar mascota</a></li>
        <li><a href="/cita">Registrar cita</a></li>
        <li><a href="/agenda">Agenda</a></li>
        <li><a href="/logout">Cerrar sesiÃ³n</a></li>
    </ul>
</nav>

<script>
    function toggleMenu() {
        const menu = document.getElementById("navMenu");
        menu.classList.toggle("show");
    }
</script>
<h1>ğŸ“… Agenda de Citas</h1>

<div class="agenda-container">

    <a href="/cita" class="boton">â• Agendar nueva cita</a>

    {% for fecha, nombre_dia, bloques in agenda %}
        <h2>ğŸ—“ï¸ {{ nombre_dia|capitalize }} {{ fecha.strftime("%d/%m/%Y") }}</h2>
        <ul>
            {% for bloque in bloques %}
            <li>
                {% if bloque.enlace %}
                    <a href="{{ bloque.enlace }}">{{ bloque.texto }}</a>
                {% else %}
                    <strong class="ocupado">{{ bloque.texto }}</strong>

                    {% if bloque.cita_id %}
                        {% if bloque.metodo_pago %}
                            {% if bloque.metodo_pago == 'efectivo' %} ğŸ’µ
                            {% elif bloque.metodo_pago == 'tarjeta' %} ğŸ’³
                            {% endif %}
                        {% else %}
                            <form method="POST" action="/actualizar_pago/{{ bloque.cita_id }}" class="inline">
                                <select name="metodo_pago" onchange="this.form.submit()">
                                    <option value="">â“</option>
                                    <option value="efectivo">ğŸ’µ</option>
                                    <option value="tarjeta">ğŸ’³</option>
                                </select>
                            </form>
                        {% endif %}

                        <form method="POST" action="/anular_cita/{{ bloque.cita_id }}" class="inline">
                            <button type="submit">âŒ Anular</button>
                        </form>
                    {% endif %}
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    {% endfor %}

    <hr>
    <h2>ğŸ“‹ Arqueo del dÃ­a</h2>
    <form method="GET" action="/arqueo">
        <button type="submit" class="boton">ğŸ’° Ver arqueo de caja</button>

    </form>

</div>
<script>
    const finPrueba = new Date("{{ fecha_fin_prueba }}T00:00:00Z");

    function actualizarContador() {
        const ahora = new Date();
        const tiempoRestante = finPrueba - ahora;

        if (tiempoRestante <= 0) {
            document.getElementById("contador").textContent = "ğŸš« Prueba finalizada";
            return;
        }

        const dias = Math.floor(tiempoRestante / (1000 * 60 * 60 * 24));
        const horas = Math.floor((tiempoRestante / (1000 * 60 * 60)) % 24);
        const minutos = Math.floor((tiempoRestante / (1000 * 60)) % 60);
        const segundos = Math.floor((tiempoRestante / 1000) % 60);

        document.getElementById("contador").textContent = `${dias} dÃ­as, ${horas}h ${minutos}m ${segundos}s`;
    }

    setInterval(actualizarContador, 1000);
    actualizarContador();
</script>


</body>
</html>
