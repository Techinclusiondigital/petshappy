{% extends "base.html" %}

{% block content %}
    <h1>Agendar Nueva Cita </h1>

    <form method="POST">
        <label for="nombre_mascota">Nombre de la mascota:</label><br>
        <div class="sugerencias-wrapper">
        <input type="text" id="nombre_mascota" name="nombre_mascota" autocomplete="off">
        <div id="sugerencias" style="display: none;"></div>
       </div>
        <br><br>

        <label for="telefono">Tel√©fono:</label><br>
        <input type="text" id="telefono" name="telefono"><br><br>

        <label for="raza">Raza:</label><br>
        <input type="text" id="raza" name="raza"><br><br>
        <label for="tamano">Tama√±o:</label><br>
        <select name="tamano" id="tamano">
            <option value="">Seleccionar...</option>
            <option value="peque√±o">Peque√±o</option>
            <option value="mediano">Mediano</option>
            <option value="grande">Grande</option>
        </select><br><br>
        <label for="tipo_servicio">Tipo de servicio:</label><br>
        <select name="tipo_servicio" id="tipo_servicio" required>
            <option value="ba√±o">üõÅ Ba√±o</option>
            <option value="ba√±o y corte">‚úÇÔ∏è Ba√±o y corte</option>
            <option value="ba√±o y repaso">Ba√±o y repaso</option>
             <option value="corte a tijera">Corte a Tijera</option>
              <option value="stripping">Stripping</option>
               <option value="corte gato">Corte gato</option>
                <option value="ba√±o gato">Ba√±o gato</option>
                 <option value="ba√±o y desenredar"> Ba√±o y desenredar</option>
                  <option value="ba√±o y muda">Ba√±o y muda</option>
                   <option value="muchos nudos">Muchos nudos</option>
                    <option value="corte u√±as">Corte u√±as</option>
        </select>
<br><br>
        <label for="duracion">Duraci√≥n:</label><br>
        <select name="duracion" required>
          <option value="45">45 minutos</option>
          <option value="60">1 hora</option>
          <option value="90">1 hora y media</option>
          <option value="120">2 horas</option>
        </select>

        <br><br>

        <label for="fecha">Fecha:</label><br>
        <input type="date" id="fecha" name="fecha" value="{{ fecha }}" required><br><br>

        <label for="hora">Hora:</label><br>
        <input type="time" id="hora" name="hora" value="{{ hora }}" required><br><br>

        <!-- Registro sugerido si no existe -->
        <div id="registro_no_encontrado" style="display: none;">
            <p>No se encontr√≥ la mascota. ¬øDeseas registrarla?</p>
            <a id="enlace_registro" href="/registrar?nombre=">
                <button type="button">Registrar nueva mascota</button>
            </a>
        </div>
  

        <label>Notas:</label><br>
        <textarea name="notas"></textarea><br><br>

        <label>Precio (‚Ç¨):</label><br>
        <input type="number" name="precio" step="0.01" value="{{ precio or '' }}"><br><br>

        <label>M√©todo de pago:</label><br>
        <select name="metodo_pago">
            <option value="">Sin registrar</option>
            <option value="efectivo">Efectivo</option>
            <option value="tarjeta">Tarjeta</option>
        </select><br><br>

        <button type="submit">Guardar Cita</button>
    </form>

    <br>
    <a href="/">Volver al inicio</a>
    <br><br>
    <br><br>

    {% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  const input = document.getElementById("nombre_mascota");
  const sugerenciasDiv = document.getElementById("sugerencias");
  const telefono = document.getElementById("telefono");
  const raza = document.getElementById("raza");
  const tamano = document.getElementById("tamano");

  input.addEventListener("input", function () {
    const query = input.value;
    if (query.length < 2) {
      sugerenciasDiv.style.display = "none";
      return;
    }

    fetch(`/sugerencias?q=${encodeURIComponent(query)}`)
      .then(response => response.json())
      .then(data => {
        sugerenciasDiv.innerHTML = "";
        if (data.length === 0) {
          sugerenciasDiv.style.display = "none";
          return;
        }

        data.forEach(mascota => {
          const div = document.createElement("div");
          div.classList.add("sugerencia-item");
          div.textContent = `${mascota.nombre} (${mascota.telefono})`;

          div.addEventListener("click", () => {
            input.value = mascota.nombre;
            telefono.value = mascota.telefono;
            raza.value = mascota.raza;
            tamano.value = mascota.tamano;
            sugerenciasDiv.style.display = "none";
          });

          sugerenciasDiv.appendChild(div);
        });

        sugerenciasDiv.style.display = "block";
      })
      .catch(error => {
        console.error("Error al cargar sugerencias:", error);
        sugerenciasDiv.style.display = "none";
      });
  });
});
</script>
{% endblock %}


{% endblock %}
 